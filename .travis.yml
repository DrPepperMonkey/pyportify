matrix:
    include:
        - os: osx
          language: objective-c
          python:
            - "3.5"
          sudo: required
          env:
            - TOXENV=py35
          before_install:
            - "brew update"
            - "brew install python3 pandoc"
            - "sudo pip3 install pyinstaller tox"
          install: 
            - "PYTHONPATH=. pyinstaller pyportify.spec"
            - "hdiutil create dist/pyportify.dmg -srcfolder dist/ -ov"
        - os: linux
          python:
            - "3.4"
            - "3.5"
          env:
            - TOXENV=py34
          language: python
          sudo: required
          before_install:
            - "sudo apt-get update"
            - "sudo apt-get install python-all-dev pandoc"
            - "pip3 install tox"
          before_deploy:
            - "pandoc -f markdown -t rst -o README.rst README.md"
script: tox
deploy:
  - provider: releases
    api_key:
      secure: SXoKAyll1TtFrQeOS5i65tzZLdZlXx5jEOnL3tlblmgcEn0sD4iILV/K/qv8KmeE8biBIdbtcqNJPh65covL8Yidaz211Hc4/MHhBU+rfqnrN0EcPR53/zmUgSbzWl7p62zvHdMSmS/iKQKT6Kv3pvyTEDL35oVX8lx0ckzcjkY
    skip_cleanup: true
    file: 'dist/pyportify.dmg'
    on:
      all_branches: true
      tags: true
      repo: rckclmbr/pyportify
      os: osx
  - provider: pypi
    user: jbraegger
    password:
      secure: P3dSxH4hgJ6JdnGc4zcCneM/jn2qczOh11uxFSJGHEvkMvL4vOrZ0yOiE8BBInUBeT/4kVfWNuBghibS1P06AlWWvUz66KHc719mpHBA3On+q/0troVXT1Pl9xiEr8ITvQda7wWgSZaxSVpaZnkMJZQQkR3ucc7p6qm4mygPyjs=
    on:
      all_branches: true
      repo: rckclmbr/pyportify
      tags: true
      os: linux
      python: 3.5
